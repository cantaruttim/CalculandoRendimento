<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <title>Calculando Rendimento</title>
</head>

<body id="background">
    <main id="main_content">
        <h1>Calculando o Rendimento Acertos</h1> <br>
        <div id="btn">
            <button value="resultado" name="resultados" id="resultado">Resultado</button>
        </div>
        <div id="resultados">

            <form id="fm" action="#">

                <input type="number" name="total" id="total" placeholder="Total de questões?" /> <br>
                <input type="number" name="acertos" id="acertos" placeholder="Acertos ... " /> <br>

            </form>
            <hr>

            <section id="information">
                <div>

                </div>

            </section>

            <section id="grafico">

            </section>

            <section id="disciplinas">

                <!-- Exatas -->
                <label for="mat">Matemática</label>
                <input type="radio" name="materia" id="mat">
                <label for="qui">Química</label>
                <input type="radio" name="materia" id="qui">
                <label for="fis">Física</label>
                <input type="radio" name="materia" id="fis">

                <!-- Biológicas -->
                <label for="bio">Biologia</label>
                <input type="radio" name="materia" id="bio">

                <!-- Humanas -->

                <label for="soc">Sociologia</label>
                <input type="radio" name="materia" id="soc">
                <label for="his">História</label>
                <input type="radio" name="materia" id="his">
                <label for="geo">Geografia</label>
                <input type="radio" name="materia" id="geo">
                <label for="filo">Filosofia</label>
                <input type="radio" name="materia" id="filo">

                <!-- Idiomas -->

                <label for="port">Português</label>
                <input type="radio" name="materia" id="port">
                <label for="ing">Inglês</label>
                <input type="radio" name="materia" id="ing">
                <label for="espa">Espanhol</label>
                <input type="radio" name="materia" id="espa">

            </section>
        </div>

        <footer>
            <p> <i> <strong> Projeto </strong> criado por <strong> Matheus Cantarutti </strong> </i></p>
        </footer>


    </main>

    <script>

        // estilo do formulário: 
        var fm = document.forms[0]; // aponto para o formulario
        var el = fm.elements; // seleciono os elementos do formulario

        for (var i = 0; i < el.length; i++) {
            el[i].style.backgroundColor = '#ddd'
        }
        // function returning NaN
        function porcentagem(ac, tv) {
            // console.log(ac, tv)
            if (isNaN(parseInt(ac)) || isNaN(parseInt(tv))) {
                return 'Not a Number!';
            } else {
                var p = ((ac * 100) / tv)
                Number(p)
            }
            return p;
        }
        // mostrando o valor obtido na tela

        const resultado = document.querySelector('#resultado')

        resultado.addEventListener("click", function (r) {
            r.preventDefault();

            const total = document.querySelector('#total');
            const total_valor = total.value;

            const acertos = document.querySelector('#acertos'); // seleco o input (elemento)
            const total_acertos = acertos.value; // (valor)

            const txt = document.querySelector('#information')
            const valortxt = document.createElement('p')

            const disciplina = document.getElementsByName('materia')


            //validando os dados do input

            if (total_valor === "" || total_acertos === "") { // se os campos estiverem vazios
                alert('[ERROR] Preencha os campos corretamente')
            } else if (disciplina.checked = false) { // se o radio não estiver marcado, dará erro
                alert('ops ... vocÊ não selecionou uma disciplina')
            } else if ((total_valor < 0) || (total_acertos < 0)) { // se o valor de questões for menor do que os de acertos
                alert('Desculpe, a quantidade de questões/acertos não pode ser negativa')
            } else { // o restante do código só será realizado apenas se todas as outras condições forem verdadeiras

                //selecionando a materia

                var materia = document.getElementsByName('materia')
                var nomeD = ' '

                if (materia[0].checked) {
                    nomeD = 'Matemática'
                } else if (materia[1].checked) {
                    nomeD = 'Química'
                } else if (materia[2].checked) {
                    nomeD = 'Física'
                } else if (materia[3].checked) {
                    nomeD = 'Biologia'
                } else if (materia[4].checked) {
                    nomeD = 'Sociologia'
                } else if (materia[5].checked) {
                    nomeD = 'História'
                } else if (materia[6].checked) {
                    nomeD = 'Geografia'
                } else if (materia[7].checked) {
                    nomeD = 'Filosofia'
                } else if (materia[8].checked) {
                    nomeD = 'Inglês'
                } else if (materia[9].checked) {
                    nomeD = 'Espanhol'
                }

                // Plotando o gráfico

                var x = [total_valor]
                var y = [total_acertos]

                var trace1 = {
                    x: ['questões'],
                    y: [total_valor],
                    name: 'Total Questões',
                    type: 'bar'
                };

                var trace2 = {
                    x: ['acertos'],
                    y: [total_acertos],
                    name: 'Total Acertos',
                    type: 'bar'
                };

                var data = [trace1, trace2];

                var layout = { barmode: 'stack' };

                Plotly.newPlot('grafico', data, layout);
                txt.appendChild(valortxt);

                let perc = porcentagem(parseInt(total_acertos), total_valor)
                // preciso resolver o problema de NaN da porcentagem
                valortxt.innerHTML = `Você selecionou ${nomeD} e obteve ${total_acertos} de um total de ${total_valor} questões. Com um total de ${perc} % de aproveitamento`
            }
        })

    </script>
</body>

</html>